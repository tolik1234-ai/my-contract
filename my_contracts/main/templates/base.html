{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}my_contracts · Dashboard{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% block extra_styles %}{% endblock %}
</head>
<body>
    <div class="background-layers" aria-hidden="true">
        <div class="background-layers__orb background-layers__orb--a"></div>
        <div class="background-layers__orb background-layers__orb--b"></div>
        <div class="background-layers__orb background-layers__orb--c"></div>
        <div class="background-grid"></div>
    </div>
    <div class="app-shell">
        <header class="top-bar">
            <a class="brand" href="{% url 'home' %}">my_contracts</a>
            <nav class="top-nav">
                {% with current=request.resolver_match.url_name %}
                <a href="{% url 'home' %}" class="nav-link{% if current == 'home' %} active{% endif %}">Home</a>
                <a href="{% url 'updates' %}" class="nav-link{% if current == 'updates' %} active{% endif %}">Updates</a>
                <a href="{% url 'docs' %}" class="nav-link{% if current == 'docs' %} active{% endif %}">Docs</a>
                <a href="{% url 'contracts' %}" class="nav-link{% if current == 'contracts' %} active{% endif %}">Contracts</a>
                {% endwith %}
            </nav>
            <div class="top-bar__actions">
                {% if request.user.is_authenticated %}
                    <a href="{% url 'profile' %}" class="user-chip">
                        <span class="user-chip__avatar" aria-hidden="true"></span>
                        <span class="user-chip__name">{{ request.user.profile.display_name|default:request.user.get_full_name|default:request.user.email }}</span>
                    </a>
                    <form method="post" action="{% url 'logout' %}" class="logout-form">
                        {% csrf_token %}
                        <button type="submit" class="ghost-action">Logout</button>
                    </form>
                {% else %}
                    <a href="{% url 'login' %}" class="ghost-action">Log in</a>
                    <a href="{% url 'register' %}" class="primary-action">Register</a>
                {% endif %}
            </div>
        </header>

        {% if messages %}
            <div class="flash-container">
                {% for message in messages %}
                    <div class="flash flash--{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <main class="dashboard">
            <section class="primary-column">
                {% block main_content %}{% endblock %}
            </section>
            <aside class="sidebar">
                <button class="connect-wallet" type="button" data-connect-wallet>
                    <span class="connect-wallet__pulse" aria-hidden="true"></span>
                    <span data-wallet-label>Connect wallet</span>
                </button>
                <div class="wallet-status" data-wallet-status>
                    <p class="wallet-status__message" data-wallet-message>
                        {% if request.user.is_authenticated and request.user.profile.wallet_address %}
                            Wallet {{ request.user.profile.wallet_address }} linked to your workspace.
                        {% else %}
                            No wallet connected yet. Use the button above to link a signer.
                        {% endif %}
                    </p>
                    <p class="wallet-status__address">
                        Signer:
                        {% if request.user.is_authenticated and request.user.profile.wallet_address %}
                            {% with addr=request.user.profile.wallet_address %}
                                <strong data-wallet-status-inline data-wallet-source data-full-address="{{ addr }}">{{ addr|slice:":6" }}…{{ addr|slice:"-4:" }}</strong>
                            {% endwith %}
                        {% else %}
                            <strong data-wallet-status-inline data-wallet-source>0x0000…0000</strong>
                        {% endif %}
                    </p>
                </div>

                <div class="card">
                    <div class="profile-card">
                        <div class="profile-avatar" aria-hidden="true"></div>
                        <div class="profile-info">
                            {% if request.user.is_authenticated %}
                                <h3>{{ request.user.profile.display_name|default:request.user.get_full_name|default:request.user.email }}</h3>
                                <span>Workspace operator</span>
                            {% else %}
                                <h3>Guest operator</h3>
                                <span>Connect to access deployments</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="profile-actions">
                        <a href="{% url 'profile' %}">Profile</a>
                        <a href="{% url 'contracts' %}">Contracts</a>
                    </div>
                </div>

                <div class="card">
                    <div class="section-header">
                        <h2>Contract blueprints</h2>
                        <a href="{% url 'contracts' %}">view all</a>
                    </div>
                    <div class="contract-list">
                        {% for contract in sidebar_contracts %}
                            <a class="contract-item" href="{% url 'contracts' %}#contract-{{ contract.identifier }}">{{ contract.display_name }}</a>
                        {% empty %}
                            <p class="contract-empty">Add the repository to list real templates.</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="card card--hint">
                    <h3>Need real deployments?</h3>
                    <p>Clone <code>smart-ultra-deployer</code> into <code>external/</code> to unlock live execution directly from this dashboard.</p>
                </div>
            </aside>
        </main>
    </div>
    <script src="{% static 'js/dashboard.js' %}" defer></script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
